# Yearly Summary Variables Reference

**Last Updated:** October 3, 2025  
**Script:** `scripts/create_dashboard_data.py`  
**Function:** `create_yearly_summary()`

This document lists all variables available in the yearly summary JSON structure generated by the dashboard data creation script.

---

## 📊 Complete Variable List

### Basic Information
```json
{
  "year": 2024,                    // int - Year of the data
  "total_births": 2260034,         // int - Total number of births
  "date_range": {
    "min": "2024-01-01",           // str - Earliest birth date (ISO format)
    "max": "2024-12-31"            // str - Latest birth date (ISO format)
  }
}
```

### Maternal Age (`maternal_age`)
Statistics about mother's age at birth.

```json
"maternal_age": {
  "mean": 27.8,                    // float - Average maternal age (years)
  "median": 27.0,                  // float - Median maternal age (years)
  "std": 6.5                       // float - Standard deviation (years)
}
```

**Source Column:** `IDADEMAE`

---

### Birth Weight (`birth_weight`)
Statistics about newborn weight at birth.

```json
"birth_weight": {
  "mean": 3150.5,                  // float - Average birth weight (grams)
  "median": 3200.0,                // float - Median birth weight (grams)
  "std": 520.3                     // float - Standard deviation (grams)
}
```

**Source Column:** `PESO`

---

### APGAR Scores (`apgar_scores`)
Average APGAR scores at 1 and 5 minutes after birth.

```json
"apgar_scores": {
  "apgar1_mean": 8.5,              // float - Average APGAR score at 1 minute
  "apgar5_mean": 9.3               // float - Average APGAR score at 5 minutes
}
```

**Source Columns:** `APGAR1`, `APGAR5`

**Clinical Note:** APGAR scores range from 0-10. Scores ≥7 are considered normal.

---

### Delivery Type (`delivery_type`)
Percentage breakdown of delivery methods.

```json
"delivery_type": {
  cesarean_rate: 60.6,      // float - Cesarean section rate (%)
  "vaginal_pct": 39.4        // float - Vaginal delivery rate (%)
}
```

**Source Column:** `PARTO` (1=Vaginal, 2=Cesarean)

**WHO Guideline:** Recommends cesarean rates between 10-15%

---

### Location (`location`)
Birth location and geographic distribution.

```json
"location": {
  "hospital_birth_pct": 98.5,     // float - Hospital births (%)
  "unique_municipalities": 5568   // int - Number of unique municipalities with births
}
```

**Source Columns:** 
- `LOCNASC` (1=Hospital, 2=Other healthcare, 3=Home, 4=Other)
- `CODMUNNASC` (Municipality code)

---

### Pregnancy Characteristics (`pregnancy`)
Statistics about pregnancy and gestational conditions.

```json
"pregnancy": {
  "multiple_pregnancy_pct": 2.4,          // float - Twin/multiple pregnancies (%)
  "preterm_birth_pct": 12.3,              // float - Preterm births <37 weeks (%)
  "extreme_preterm_birth_pct": 2.1,       // float - Extreme preterm <32 weeks (%)
  "adolescent_pregnancy_pct": 14.2,       // float - Mother <20 years (%)
  "very_young_pregnancy_pct": 0.8,        // float - Mother <15 years (%)
  "gestational_weeks_mean": 38.5,         // float - Average gestational weeks
  "gestational_weeks_median": 39.0        // float - Median gestational weeks
}
```

**Source Columns:**
- `GRAVIDEZ` (1=Single, 2=Twin, 3=Triplet+)
- `GESTACAO` (Categories: 1=<22w, 2=22-27w, 3=28-31w, 4=32-36w, 5=37-41w, 6=42w+)
- `SEMAGESTAC` (Numeric weeks)
- `IDADEMAE` (Mother's age)

**Calculation Details:**
- **Preterm births:** `GESTACAO < 5` (less than 37 weeks)
- **Extreme preterm:** `GESTACAO < 3` (less than 32 weeks)
- **Adolescent pregnancy:** `IDADEMAE < 20`
- **Very young pregnancy:** `IDADEMAE < 15`

**Clinical Notes:**
- Normal gestation: 37-42 weeks
- Preterm: <37 weeks
- Moderate preterm: 32-37 weeks
- Very preterm: 28-32 weeks
- Extremely preterm: <28 weeks

---

### Health Indicators (`health_indicators`)
⭐ **Priority Indicators** - Rate-based metrics for policy action.

```json
"health_indicators": {
  "low_birth_weight_pct": 8.5,           // float - Birth weight <2,500g (%)
  "low_apgar5_pct": 1.2                  // float - APGAR5 score <7 (%)
}
```

**Source Columns:**
- `PESO` (Birth weight in grams)
- `APGAR5` (APGAR score at 5 minutes)

**Calculation Details:**
- **Low birth weight:** `PESO < 2500` grams
- **Low APGAR5:** `APGAR5 < 7` (concerning score)

**Clinical Notes:**
- Low birth weight (<2,500g) is associated with increased infant mortality
- APGAR5 <7 indicates potential need for medical intervention
- WHO categorizes low birth weight as a key indicator for monitoring newborn health

---

## 📈 Variables Used in Dashboard

### Home Page Cards
The home page displays these priority indicators in summary cards:

**Left Column (Quality Indicators):**
- `health_indicators.low_birth_weight_pct` → "Baixo Peso" 🏋️
- `pregnancy.adolescent_pregnancy_pct` → "Adolescentes" 👥
- `health_indicators.low_apgar5_pct` → "APGAR5 Baixo" ❤️

**Right Column (Process/Coverage):**
- `delivery_type.` → "Cesárea" 🏥
- `pregnancy.preterm_birth_pct` → "Prematuros" ⚠️
- `location.hospital_birth_pct` → "Hospitalar" 🏥

### Annual Page Cards
Additional detail cards with means:
- `maternal_age.mean` → "Idade Materna Média"
- `birth_weight.mean` → "Peso Médio ao Nascer"
- Plus all home page indicators

---

## 🔄 Aggregate Files

### Monthly Aggregates
These variables are calculated monthly and include both percentages and absolute counts:

**Percentages:**
- `preterm_birth_pct`
- `extreme_preterm_birth_pct`
- `adolescent_pregnancy_pct`
- `very_young_pregnancy_pct`
- `low_birth_weight_pct`
- `low_apgar5_pct`
- ``
- `multiple_pregnancy_pct`
- `hospital_birth_pct`

**Absolute Counts:**
- `preterm_birth_count`
- `extreme_preterm_birth_count`
- `adolescent_pregnancy_count`
- `very_young_pregnancy_count`
- `low_birth_weight_count`
- `low_apgar5_count`

---

## 💡 Why Rates Are Better Than Means

For geographic and temporal analysis, **rate-based indicators** are prioritized over **mean-based indicators**:

### Rate-Based (Preferred) ✅
- **Low birth weight rate** (% of births <2,500g)
- **Low APGAR5 rate** (% of scores <7)
- **Adolescent pregnancy rate** (% of mothers <20)
- **Preterm birth rate** (% of births <37 weeks)

### Mean-Based (Secondary) ⚠️
- Average maternal age
- Average birth weight
- Average gestational weeks
- Average APGAR scores

### Advantages of Rates:
1. **Actionable:** Clear threshold for intervention
2. **Comparable:** Standardized across regions/times
3. **Policy-relevant:** Direct measure of outcomes
4. **WHO-aligned:** Matches international standards
5. **Risk-focused:** Identifies vulnerable populations

### When to Use Means:
- Overall population health monitoring
- Long-term trend detection
- Contextual understanding
- Supplementary to rate indicators

---

## 🔍 Data Sources

All variables are derived from SINASC (Sistema de Informações sobre Nascidos Vivos) raw data:

**Primary Columns:**
- `DTNASC` - Birth date
- `IDADEMAE` - Mother's age
- `PESO` - Birth weight
- `APGAR1`, `APGAR5` - APGAR scores
- `PARTO` - Delivery type
- `GESTACAO` - Gestational age category
- `SEMAGESTAC` - Gestational weeks (numeric)
- `LOCNASC` - Birth location
- `GRAVIDEZ` - Single/multiple pregnancy
- `CODMUNNASC` - Municipality code

**Data Processing:**
1. Missing values converted to `pd.NA`
2. Invalid codes (99, 9, etc.) excluded from calculations
3. Numeric conversions with `pd.to_numeric(errors='coerce')`
4. Percentages calculated as `(condition).mean() * 100`

---

## 📝 Usage Examples

### Loading Yearly Summary
```python
import json

# From metadata.json
with open('dashboard_data/metadata.json') as f:
    metadata = json.load(f)
    
# Get summary for 2024
summary_2024 = next(
    s for s in metadata['yearly_summaries'] 
    if s['year'] == 2024
)

# Access specific metrics
total_births = summary_2024['total_births']
cesarean_rate = summary_2024['delivery_type']['']
low_weight_rate = summary_2024['health_indicators']['low_birth_weight_pct']
adolescent_rate = summary_2024['pregnancy']['adolescent_pregnancy_pct']

print(f"Total births: {total_births:,}")
print(f"Cesarean rate: {cesarean_rate:.1f}%")
print(f"Low birth weight: {low_weight_rate:.1f}%")
print(f"Adolescent pregnancies: {adolescent_rate:.1f}%")
```

### Using in Dashboard Callbacks
```python
from data.loader import data_loader

@app.callback(Output('metric-card', 'children'), Input('year', 'value'))
def update_card(year):
    summary = data_loader.get_year_summary(year)
    
    # Access nested structure
    low_weight_rate = summary.get('health_indicators', {}).get('low_birth_weight_pct', 0)
    
    return f"{low_weight_rate:.1f}%"
```

---

## 🎯 Quick Reference

| Variable Path | Type | Range | Clinical Threshold |
|--------------|------|-------|-------------------|
| `total_births` | int | - | - |
| `maternal_age.mean` | float | 10-50 | - |
| `birth_weight.mean` | float | 500-5000 | <2500g = low |
| `apgar_scores.apgar5_mean` | float | 0-10 | <7 = concerning |
| `delivery_type.` | float | 0-100 | WHO: 10-15% |
| `pregnancy.preterm_birth_pct` | float | 0-100 | <37 weeks |
| `pregnancy.extreme_preterm_birth_pct` | float | 0-100 | <32 weeks |
| `pregnancy.adolescent_pregnancy_pct` | float | 0-100 | <20 years |
| `pregnancy.very_young_pregnancy_pct` | float | 0-100 | <15 years |
| `health_indicators.low_birth_weight_pct` | float | 0-100 | <2500g |
| `health_indicators.low_apgar5_pct` | float | 0-100 | <7 score |
| `location.hospital_birth_pct` | float | 0-100 | High = good |

---

## ✨ Recent Changes

**October 3, 2025:**
- ✅ Added `extreme_preterm_birth_pct` to pregnancy section
- ✅ Added `adolescent_pregnancy_pct` to pregnancy section
- ✅ Added `very_young_pregnancy_pct` to pregnancy section
- ✅ Added `low_birth_weight_pct` to health_indicators section
- ✅ Added `low_apgar5_pct` to health_indicators section
- ✅ Updated console output to display new indicators
- ✅ Updated README.md with new metrics
- ✅ Added corresponding count variables to monthly aggregates

These additions make the summary JSON fully aligned with the dashboard UI requirements and prioritize actionable rate-based indicators over mean-based statistics.

---

*For more information, see:*
- `scripts/create_dashboard_data.py` - Data generation script
- `dashboard_data/README.md` - Data files documentation
- `dashboard/pages/GEOGRAPHIC_PLANNING.md` - Geographic analysis indicators
- `.github/copilot-instructions.md` - Project conventions
